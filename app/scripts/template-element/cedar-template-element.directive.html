<div ng-if="model !== undefined" class="element-root" id="{{$root.getDomId(element)}}">
  <div>
    <div class="element-header" ng-class="{'sortable-handler': !$root.isRuntime()}">
      <a ng-click="switchExpandedState()" class="visibilitySwitch"><i class="cedar-svg-collapse"></i></a>
      <a ng-click="switchExpandedState()" class="visibilitySwitch" style="display:none;"><i class="cedar-svg-expand"></i></a>

      <p class="element-name-label">
        <span  ng-class="{'sortable-icon': !$root.isRuntime()}" ></span><i class="cedar-svg-element"></i>{{$root.propertiesOf(element)._ui.title}}
      </p>
      <span class="multiple-instance-cardinality" ng-show="!$root.isRuntime() && $root.elementIsMultiInstance(element)">
        {{element.minItems}} .. {{element.maxItems || "Unlimited"}}
      </span>

      <div ng-if="!isRootElement" class="preview-edit-options" id="previewEditOptionOfElement" ng-include="'scripts/form/partials/preview-edit-options.partial.html'"></div>
      <span ng-show="$root.isArray(model) && $root.applicationMode == 'runtime'" class="spreadsheetSwitch element">
        <a ng-click="switchToSpreadsheet()" class="spreadsheetSwitchLink">
          <i class="cedar-svg-spreadsheet"></i>
        </a>
      </span>
    </div>
  </div>

  <div class="elementTotalContent visible">

    <div ng-show="$root.isArray(model)">
      <div class="spreadsheetViewDetector"></div>
      <div class="spreadsheetViewContainer"></div>
    </div>

    <div class="elements originalContent">
      <div class="element-toggles list" ng-if="$root.isRuntime() && $root.elementIsMultiInstance(element)">
        <div class="element-toggle" 
             ng-class="{active: selectedTab == $index}"
             ng-repeat="m in model"
             ng-click="selectTab($index)"
             ng-if="$root.isArray(model) && model.length > 0">
          <span>{{$index + 1}}</span>
        </div>
        <div class="add-element">
          <button type="button" ng-click="addElement()" class="add zero" ng-show="true" ng-disabled="preview">
            <i class="fa fa-plus"></i>

            <div class="cardinality-_ui-container">
              <div class="cardinality-_ui">
                <div class="cardinality-_ui-text">
                  <span translate="GENERIC.MultipleMinMaxMsg" translate-values="{min:element.minItems, max:(element.maxItems || 'GENERIC.Unlimited' | translate)}"></span>
                </div>
              </div>
            </div>
          </button>
        </div>
        <div class="clearfix"></div>
      </div> <!-- /.date-type-toggle -->

      <div ng-if="$root.isArray(model) && selectedTab == $index" class="element" ng-repeat="m in model" ng-class="['element-{{$index}}']">
        <div class="remove-element pull-right">
          <a class="" ng-show="model.length > element.minItems" ng-click="removeElement($index)" translate>GENERIC.Remove</a>
        </div>

        <div ui-sortable="$root.sortableOptions" ng-model="element._ui.order" class="sortable-container">
          <div ng-repeat="key in element['_ui']['order']">
            <div ng-if="$root.propertiesOf(element)[key]">
              <cedar-nested-template-element key="key" 
                                             field="$root.propertiesOf(element)[key]"
                                             model="m[key]"
                                             remove-child="removeChild"
                                             rename-child-key="renameChildKey">
              </cedar-nested-template-element>
            </div>
          </div>
        </div>
      </div>

      <div ng-if="!$root.isArray(model)" class="element only-element" ui-sortable="$root.sortableOptions" ng-model="element._ui.order">
        <div ng-repeat="key in element['_ui']['order']">
          <div ng-if="$root.propertiesOf(element)[key]">
            <cedar-nested-template-element key="key"
                                           field="$root.propertiesOf(element)[key]"
                                           model="model[key]"
                                           remove-child="removeChild"
                                           rename-child-key="renameChildKey">
            </cedar-nested-template-element>
          </div>
        </div>
      </div>

      <div class="input-type-container" ng-if="!$root.isRuntime() && !isRootElement && $root.propertiesOf(element)._tmp.state == 'creating'">
        <div class="row">
          <div class="configuration-options element-configuration-options col-lg-9 pull-left">
            <div class="checkbox checkbox-inline checkbox-cardinality">
              <input type="checkbox" id="cardinality-{{element['@id'].substring(element['@id'].lastIndexOf('/')+1)}}" ng-model="$root.propertiesOf(element)._ui.is_cardinal_field" />
              <label for="cardinality-{{element['@id'].substring(element['@id'].lastIndexOf('/')+1)}}">Cardinality</label>
            </div><!-- /.checkbox-inline -->
            <div class="clearfix"></div>

            <!-- Cardinality Options -->
            <div id="cardinality-options" class="cardinality-options" ng-show="$root.propertiesOf(element)._ui.is_cardinal_field">
              <div class="form-group validation-pattern pull-left min-items-option">
                <label>Min:</label>
                <select class=""
                        ng-model="element.minItems"
                        ng-options="v.value as v.label for v in $root.minCardinalities"
                        select-picker=""
                        title="">
                </select>
              </div><!-- /.form-group -->

              <div class="form-group validation-pattern pull-left max-items-option">
                <label>Max:</label>
                <select class=""
                        ng-model="element.maxItems"
                        ng-options="v.value as v.label for v in $root.maxCardinalities"
                        select-picker=""
                        title="">
                </select>
              </div><!-- /.form-group -->
            </div><!-- /.cardinality-options -->
          </div>
          <div class="configuration-options col-lg-3 pull-right configuration-actions" ng-include="'scripts/form/partials/staging-area-actions.partial.html'"></div>
          <div class="clearfix"></div>
        </div>
      </div>
    </div>
  </div>
</div>
