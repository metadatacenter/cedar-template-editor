<form name="forms.templateForm" id="{{form['@id'].substr(form['@id'].lastIndexOf('/') + 1) + '-' + path}}"
    ng-class="{'validate': checkSubmission}" novalidate>
  <!--Loop through top level "page" parameter in form element and call cedar-template-element or field-directive with contents -->

  <!--At Runtime, the old form-->
  <!--<div class="page build" ng-if="$root.isRuntime() && !$root.useRunTimeCode" ng-repeat="page in pagesArray">-->
    <!--<div ng-repeat="item in page" class="animate-fade" ng-show="pageIndex == $parent.$index">-->
      <!--<span ng-if="form.properties[item]">-->
        <!--&lt;!&ndash;If Template field&ndash;&gt;-->
        <!--<div ng-if="form.properties[item]['@type']=='https://schema.metadatacenter.org/core/TemplateField' || form.properties[item]['@type']=='https://schema.metadatacenter.org/core/StaticTemplateField' ||-->
        <!--form.properties[item].items['@type']=='https://schema.metadatacenter.org/core/TemplateField' || form.properties[item].items['@type']=='https://schema.metadatacenter.org/core/StaticTemplateField'"-->
            <!--ng-class="{'field-instance':true, 'multiple-instance-field':form.properties[item].type == 'array'}">-->
          <!--<field-directive field="form.properties[item]" model="model[item]"-->
              <!--delete="removeChild(form.properties[item]); $event.stopPropagation();"-->
              <!--rename-child-key="renameChildKey"-->
              <!--is-edit-data="isEditData"></field-directive>-->
        <!--</div>-->
        <!--&lt;!&ndash;If Template Element&ndash;&gt;-->
        <!--<div class=" element-group full "-->
            <!--ng-if="form.properties[item]['@type']=='https://schema.metadatacenter.org/core/TemplateElement' || form.properties[item].items['@type']=='https://schema.metadatacenter.org/core/TemplateElement'">-->
          <!--<cedar-template-element element="form.properties[item]"-->
              <!--key="item"-->
              <!--model="model[item]"-->
              <!--delete="removeChild(form.properties[item])"-->
              <!--is-edit-data="isEditData">-->
          <!--</cedar-template-element>-->
        <!--</div>-->
      <!--</span>-->
    <!--</div>-->
  <!--</div>-->

  <!--At runtime, the new form-->
  <div class="page runtime"  ng-if="$root.isRuntime() && $root.useRunTimeCode" ng-repeat="page in pagesArray">

    <div class="flagpole"></div>

    <div class="row">
      <div class="col-sm-9 ">

          <span>
            <button type="button" ng-click="toggleExpanded()" ng-class="{'xxx' : isExpanded(i), 'expand' : !isExpanded()}">
              <i ng-class="{'fa fa-caret-down' : isExpanded(), 'fa fa-caret-right' : !isExpanded()}"></i> </button>
            <span class="title">{{$root.schemaOf(form)._ui.title}}</span>
          </span>
      </div>
      <div class="col-sm-3">
      </div>
    </div>


    <div ng-repeat="item in page" class="animate-fade"  ng-show="pageIndex == $parent.$index">

      <span ng-if="form.properties[item]">

        <!--If static field-->
        <!--<div ng-if="isStaticField(item)" class="static-field-instance">-->
          <!--<cedar-runtime-field field="form.properties[item]" model="model[item]"-->
              <!--delete="removeChild(form.properties[item]);"-->
              <!--rename-child-key="renameChildKey"-->
              <!--is-edit-data="isEditData" depth="1"-->
              <!--path="0"></cedar-runtime-field>-->
        <!--</div>-->

        <!--If field-->
        <div ng-if="isField(item)" class="field-instance">
          <cedar-runtime-field field="form.properties[item]" model="model[item]"
              delete="removeChild(form.properties[item]);"
              rename-child-key="renameChildKey"
              is-edit-data="isEditData"
              depth="1"
              path="0"
              previous="form.properties[page[$index-1]]"></cedar-runtime-field>
        </div>


        <!--If element-->
        <div ng-if="isElement(item)"  class="element-group full" >
          <cedar-runtime-element element="form.properties[item]"
              key="item"
              model="model[item]"
              delete="removeChild(form.properties[item])"
              is-edit-data="isEditData"
              depth="1"
              path="0">
          </cedar-runtime-element>
        </div>
      </span>
    </div>
  </div>
  <p ng-if="form.requiredFields" class="required-text">Required</p>

  <!--At build time, the old form-->
  <div class="page build" ng-if="!$root.isRuntime()" ui-sortable="$root.sortableOptions" ng-model="form._ui.order">
    <div ng-repeat="item in form._ui.order" class="animate-fade">
      <span ng-if="form.properties[item]">

        <!--If  field-->
        <div ng-if="form.properties[item]['@type']=='https://schema.metadatacenter.org/core/TemplateField' || form.properties[item]['@type']=='https://schema.metadatacenter.org/core/StaticTemplateField' ||
        form.properties[item].items['@type']=='https://schema.metadatacenter.org/core/TemplateField' || form.properties[item].items['@type']=='https://schema.metadatacenter.org/core/StaticTemplateField'"

            ng-class="{'field-instance':true, 'multiple-instance-field':form.properties[item].type == 'array'}">
          <field-directive field="form.properties[item]" model="model[item]"
              delete="removeChild(form.properties[item]); $event.stopPropagation();"
              rename-child-key="renameChildKey"></field-directive>
        </div>

        <!--If  Element-->
        <div class="element-group full"
            ng-if="form.properties[item]['@type']=='https://schema.metadatacenter.org/core/TemplateElement' || form.properties[item].items['@type']=='https://schema.metadatacenter.org/core/TemplateElement'">
          <cedar-template-element element="form.properties[item]"
              key="item"
              model="model[item]"
              delete="removeChild(form.properties[item])"
              is-root-element="hideRootElement"
              is-edit-data="isEditData",
              depth="1">
          </cedar-template-element>
        </div>
      </span>
    </div>
  </div>

</form>

<div ng-if="form._ui.pages.length > 1 && $root.isRuntime()" class="pagination-container">
  <ul class="pagination">
    <li ng-if="pageIndex > 0"><a ng-click="previousPage()"><span class="prev"><i
        class="fa fa-lg fa-angle-left"></i><span translate>GENERIC.Previous</span></span></a></li>
    <li ng-repeat="(index, value) in form._ui.pages" ng-class="{active: index == pageIndex}"><a
        ng-click="setCurrentPage(index)">{{index + 1}}</a></li>
    <li ng-if="pageIndex < (form._ui.pages.length - 1)"><a ng-click="nextPage()"><span class="next"><span translate>GENERIC.Next</span><i
        class="fa fa-lg fa-angle-right"></i></span></a></li>
  </ul>
</div><!-- /.pagination-container -->

<div ng-if="$root.isRuntime()">
  <ng-include src="'scripts/layout/json_preview.html'"></ng-include>
</div>
